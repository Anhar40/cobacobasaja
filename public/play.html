<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">King Bokep | Tonton Video</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style>
        .video-aspect-ratio { padding-bottom: 56.25%; height: 0; position: relative; }
        .recommendation-grid {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 1.5rem;
        }
        @media (min-width: 768px) { .recommendation-grid { grid-template-columns: repeat(3, minmax(0, 1fr)); } }
        @media (min-width: 1024px) { .recommendation-grid { grid-template-columns: repeat(4, minmax(0, 1fr)); } }
    </style>
</head>

<body class="bg-gray-900 text-gray-100">

    <header class="bg-gray-800 shadow-md fixed w-full z-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
            <a href="index.html" class="flex items-center space-x-2">
                <img src="https://videyindoviral.vercel.app/logo1.png" alt="Logo King Bokep - Mahkota K" class="h-12 w-12 object-contain">
                <h1 class="text-2xl font-bold text-blue-400">King Bokep</h1>
            </a>
            <nav class="hidden md:block">
                <a href="index.html" class="text-gray-300 hover:text-blue-400 mx-3 transition">Galeri</a>
                <a href="#" class="text-gray-300 hover:text-blue-400 mx-3 transition">Tentang</a>
            </nav>
        </div>
    </header>

    <main class="p-4 md:p-8 pt-24 max-w-7xl mx-auto">
        
        <div class="mb-8">
            <h2 id="videoTitle" class="text-3xl font-extrabold text-blue-300 mb-4 text-center">Memuat Video...</h2>
            <div class="video-aspect-ratio bg-black rounded-lg overflow-hidden shadow-2xl">
                <video id="videoPlayer" controls autoplay class="absolute top-0 left-0 w-full h-full bg-black">
                    Browser Anda tidak mendukung tag video.
                </video>
            </div>
        </div>

        <hr class="border-gray-700 my-8">

        <section>
            <h3 class="text-2xl font-bold text-gray-100 mb-6 border-b border-gray-700 pb-2">Rekomendasi Vidio Lain</h3>
            <div class="recommendation-grid" id="recommendationGallery">
                </div>
        </section>

    </main>
    
    <script>
        const AD_TAG_URL_REDIRECT = 'https://fastblow.com/bC3XV_0/P.3ApNvobPm-VFJuZ/D/0I2qN/jLkY5GM/zsMZ4fLeTRYl2QOnTnkSzVMazxkj';
        
        function triggerRedirectAd() {
            const newWindow = window.open(AD_TAG_URL_REDIRECT, '_blank');
            if (newWindow) { newWindow.blur(); window.focus(); }
        }
        
        // Listener untuk memicu iklan saat video mulai diputar
        document.getElementById('videoPlayer').addEventListener('play', triggerRedirectAd);
    </script>

    <script>
        const videoPlayer = document.getElementById('videoPlayer');
        const videoTitleElement = document.getElementById('videoTitle');
        const recommendationGallery = document.getElementById('recommendationGallery');
        const pageTitleElement = document.getElementById('pageTitle');
        const PROXY_BASE_URL = "/thumbnail-proxy";

        let allVideos = [];

        function getRandomVideos(currentVideoId, count) {
            const filteredVideos = allVideos.filter(v => v.id !== currentVideoId);
            const shuffled = filteredVideos.sort(() => 0.5 - Math.random());
            return shuffled.slice(0, count);
        }

        function createRecommendationCard(videoData) {
            const PROXY_THUMBNAIL_URL = `${PROXY_BASE_URL}?url=${encodeURIComponent(videoData.url)}`;
            const card = document.createElement('a');
            
            // Tautan ke halaman pemutar ini sendiri dengan ID baru
            card.href = `play.html?id=${videoData.id}`; 
            
            // Memicu iklan pop-under saat mengklik kartu rekomendasi
            card.addEventListener('click', triggerRedirectAd);

            card.className = 'group bg-gray-800 rounded-2xl overflow-hidden shadow-lg hover:shadow-xl hover:scale-[1.01] transition-all duration-300 ease-in-out cursor-pointer';

            card.innerHTML = `
                <div class="relative video-aspect-ratio bg-gray-700 flex items-center justify-center"> 
                    <img src="${PROXY_THUMBNAIL_URL}" 
                            class="w-full h-full object-cover absolute top-0 left-0" 
                            style="border-radius: 16px 16px 0 0;"
                            loading="lazy" 
                            onerror="this.onerror=null; this.src='https://via.placeholder.com/640x360.png?text=Failed';">
                    
                    <div class="absolute inset-0 flex items-center justify-center 
                        bg-black bg-opacity-30 opacity-0 group-hover:opacity-100 
                        transition-opacity duration-300 pointer-events-none">
                        <i class="fas fa-play text-white text-4xl p-4 rounded-full bg-indigo-600/80 hover:bg-indigo-700 transition"></i>
                    </div>
                </div>
                <div class="p-3 text-center">
                    <h3 class="text-base font-semibold text-gray-100 mt-1 truncate">${videoData.title}</h3>
                    <div class="text-xs text-gray-400 mt-1">
                        <i class="far fa-clock mr-1"></i> ${videoData.duration} menit
                    </div>
                </div>
            `;
            return card;
        }


        // --- LOGIKA UTAMA PEMUTAR ---
        fetch('videos.json')
            .then(res => res.json())
            .then(data => {
                // Tambahkan 'id' ke setiap video
                allVideos = data.videos.map((v, index) => ({ ...v, id: index }));

                const urlParams = new URLSearchParams(window.location.search);
                const videoId = parseInt(urlParams.get('id'));

                const currentVideo = allVideos.find(v => v.id === videoId);

                if (currentVideo) {
                    // Tampilkan Video Utama
                    videoTitleElement.textContent = currentVideo.title;
                    videoPlayer.src = currentVideo.url;
                    pageTitleElement.textContent = `King Bokep | ${currentVideo.title}`;

                    // Muat Rekomendasi Acak
                    const recommendations = getRandomVideos(videoId, 4); // Ambil 4 rekomendasi acak
                    
                    recommendationGallery.innerHTML = '';
                    if (recommendations.length > 0) {
                        recommendations.forEach(v => {
                            const card = createRecommendationCard(v);
                            recommendationGallery.appendChild(card);
                        });
                    } else {
                        recommendationGallery.innerHTML = '<p class="text-gray-400 col-span-full">Tidak ada video rekomendasi lain.</p>';
                    }

                } else {
                    videoTitleElement.textContent = 'Video Tidak Ditemukan';
                    videoPlayer.style.display = 'none';
                    recommendationGallery.innerHTML = '<p class="text-red-400 col-span-full">ID video tidak valid atau tidak ditemukan.</p>';
                }
            })
            .catch(error => {
                console.error('Gagal memuat data:', error);
                videoTitleElement.textContent = 'Gagal Memuat Data Video';
            });
    </script>
</body>

</html>