<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="856cde973fd701ac6797fa601174d75e9ce3c603" content="856cde973fd701ac6797fa601174d75e9ce3c603" />
    <title>ðŸŽ¬ Galeri Video Responsif & Paginasi Input</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <script src="//imasdk.googleapis.com/js/sdkloader/ima3.js"></script>

    <style>
        /* Gaya kustom (sama seperti sebelumnya) */
        .animate-fadeIn {
            animation: fadeIn 0.5s ease-out forwards;
            opacity: 0;
        }
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        .video-aspect-ratio {
            padding-bottom: 56.25%; /* 16:9 ratio */
            height: 0;
            position: relative;
        }
        .video-grid {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr)); 
            gap: 1.5rem; 
        }
        @media (min-width: 768px) { 
            .video-grid {
                grid-template-columns: repeat(3, minmax(0, 1fr)); 
            }
        }
        @media (min-width: 1024px) { 
            .video-grid {
                grid-template-columns: repeat(4, minmax(0, 1fr)); 
            }
        }
        /* Pastikan adContainer berada di atas video player */
        #adContainer {
            z-index: 10; 
            background: black; /* Latar belakang hitam saat iklan berjalan */
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <header class="bg-white shadow-md fixed w-full z-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
            <h1 class="text-2xl font-bold text-indigo-600">Video Gallery ðŸ“±</h1>
            <nav class="hidden md:block">
                <a href="#" class="text-gray-600 hover:text-indigo-600 mx-3 transition">Home</a>
                <a href="#" class="text-gray-600 hover:text-indigo-600 mx-3 transition">Tentang</a>
            </nav>
        </div>
    </header>

    <main class="p-4 md:p-8 pt-24"> 
        <header class="mb-10 text-center">
            <h1 class="text-4xl font-extrabold text-indigo-700 mb-2 tracking-tight">
                Koleksi Video Responsif
            </h1>
            <p class="text-gray-500 italic">Tampilan 2 kolom di ponsel, paginasi input aktif.</p>
        </header>

        <div class="max-w-7xl mx-auto">
            <div class="video-grid" id="videoGallery">
                </div>
            
            <div class="mt-10 flex flex-col sm:flex-row justify-between items-center space-y-4 sm:space-y-0">
                <div id="paginationContainer" class="flex justify-center space-x-2">
                    </div>

                <div class="flex items-center space-x-2">
                    <label for="pageInput" class="text-gray-600 font-medium whitespace-nowrap">Lompat ke:</label>
                    <input type="number" id="pageInput" 
                           class="w-20 px-3 py-2 border border-gray-300 rounded-lg text-center focus:ring-indigo-500 focus:border-indigo-500" 
                           min="1" value="1">
                    <button id="goToPageButton" 
                            class="px-4 py-2 bg-indigo-600 text-white rounded-lg font-semibold hover:bg-indigo-700 transition duration-300">
                        Go
                    </button>
                </div>
            </div>
            
            <p id="infoPaginasi" class="text-center text-sm text-gray-500 mt-4"></p>
        </div>
    </main>

    <div id="videoModal" class="fixed inset-0 bg-black bg-opacity-75 hidden items-center justify-center z-50 transition-opacity duration-300" 
         role="dialog" aria-modal="true">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-4xl m-4 relative p-4">
            <button id="closeModal" class="absolute -top-3 -right-3 bg-red-600 text-white rounded-full p-2 w-8 h-8 flex items-center justify-center shadow-lg hover:bg-red-700 transition"
                    aria-label="Tutup Modal">
                <i class="fas fa-times text-sm"></i>
            </button>
            <h2 id="modalTitle" class="text-xl font-bold mb-3 text-gray-800"></h2>
            <div class="video-aspect-ratio">
                <video id="videoPlayer" controls class="absolute top-0 left-0 w-full h-full bg-black rounded-lg" poster="">
                    Browser Anda tidak mendukung tag video.
                </video>
                
                <div id="adContainer" class="absolute top-0 left-0 w-full h-full"></div>
            </div>
        </div>
    </div>

    <script>
        const gallery = document.getElementById('videoGallery');
        const paginationContainer = document.getElementById('paginationContainer');
        const infoPaginasi = document.getElementById('infoPaginasi');
        const modal = document.getElementById('videoModal');
        const closeModalButton = document.getElementById('closeModal');
        const videoPlayer = document.getElementById('videoPlayer');
        const modalTitle = document.getElementById('modalTitle');
        
        const pageInput = document.getElementById('pageInput');
        const goToPageButton = document.getElementById('goToPageButton');

        // Elemen baru untuk iklan
        const adContainer = document.getElementById('adContainer');

        const PROXY_BASE_URL = "/thumbnail-proxy";
        const VIDEOS_PER_PAGE = 8; 

        let allVideos = [];
        let currentPage = 1;

        // 3. PERUBAHAN UTAMA: MENGGUNAKAN URL IKLAN YANG ANDA BERIKAN
        const AD_TAG_URL = 'https://fastblow.com/d.mEFGzOd/G-NsvkZvGbUM/Yegmg9ruTZSUxlKkFPQTwYe2/OiTLYlyKOqD/g/tcNUjnYj5ANUj/IJ4VOmSpZvsQalWM1Op-dqD/0XxN';

        let adsLoader;
        let adsManager;
        
        // --- FUNGSI IMA BARU UNTUK INISIALISASI IKLAN ---
        
        function initImaAds() {
            // Sembunyikan ad container di awal
            adContainer.style.display = 'none';

            const adDisplayContainer = new google.ima.AdDisplayContainer(adContainer, videoPlayer);
            adsLoader = new google.ima.AdsLoader(adDisplayContainer);
            
            adsLoader.addEventListener(
                google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,
                onAdsManagerLoaded,
                false
            );
            adsLoader.addEventListener(
                google.ima.AdErrorEvent.Type.AD_ERROR,
                onAdError,
                false
            );

            // Inisialisasi Kontainer
            try {
                adDisplayContainer.initialize();
                requestAds();
            } catch (e) {
                console.error("IMA AdDisplayContainer initialization failed:", e);
                // Jika gagal, langsung putar video konten
                videoPlayer.play(); 
            }
        }

        function requestAds() {
            const adsRequest = new google.ima.AdsRequest();
            adsRequest.adTagUrl = AD_TAG_URL;
            adsRequest.linearAdSlotWidth = videoPlayer.clientWidth;
            adsRequest.linearAdSlotHeight = videoPlayer.clientHeight;
            
            adsLoader.requestAds(adsRequest);
        }
        
        function onAdsManagerLoaded(adsManagerLoadedEvent) {
            const adsRenderingSettings = new google.ima.AdsRenderingSettings();
            adsRenderingSettings.restoreCustomPlaybackStateOnAdBreakComplete = true;

            adsManager = adsManagerLoadedEvent.getAdsManager(videoPlayer, adsRenderingSettings);

            adsManager.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR, onAdError);
            adsManager.addEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED, onContentPauseRequested);
            adsManager.addEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED, onContentResumeRequested);
            adsManager.addEventListener(google.ima.AdEvent.Type.ALL_ADS_COMPLETED, onAdCompleted);

            try {
                // Dimulai dengan init dan start iklan
                adsManager.init(videoPlayer.clientWidth, videoPlayer.clientHeight, google.ima.ViewMode.NORMAL);
                adsManager.start();
            } catch (adError) {
                console.error("IMA AdsManager failed to start:", adError);
                videoPlayer.play(); // Mainkan konten jika iklan gagal dimulai
            }
        }

        function onAdError(adErrorEvent) {
            console.error("Ad Error:", adErrorEvent.getError().getMessage());
            if (adsManager) {
                adsManager.destroy();
            }
            // Lanjutkan pemutaran konten utama
            onContentResumeRequested(); 
        }

        function onContentPauseRequested() {
            // Iklan akan segera diputar. Jeda konten dan tampilkan kontainer iklan.
            videoPlayer.pause();
            adContainer.style.display = 'block';
        }

        function onContentResumeRequested() {
            // Iklan selesai, sembunyikan kontainer iklan dan putar konten.
            adContainer.style.display = 'none';
            videoPlayer.play();
        }
        
        function onAdCompleted() {
             // Pastikan konten diputar setelah semua iklan (pre-roll) selesai
            onContentResumeRequested();
        }
        
        // --- FUNGSI PAGINASI (Tidak Berubah) ---
        
        function createVideoCardWithProxyThumbnail(videoData, index) {
             const PROXY_THUMBNAIL_URL = `${PROXY_BASE_URL}?url=${encodeURIComponent(videoData.url)}`;
            const card = document.createElement('div');
            
            card.className = 'group bg-white rounded-2xl overflow-hidden shadow-xl hover:shadow-2xl hover:scale-[1.01] transition-all duration-300 ease-in-out cursor-pointer animate-fadeIn';
            card.style.animationDelay = `${index * 0.05}s`; 
            card.dataset.url = videoData.url; 
            card.dataset.title = videoData.title;

            card.innerHTML = `
                <div class="relative video-aspect-ratio bg-gray-200 flex items-center justify-center"> 
                    <img src="${PROXY_THUMBNAIL_URL}" 
                         class="w-full h-full object-cover absolute top-0 left-0" 
                         style="border-radius: 16px 16px 0 0;"
                         loading="lazy" 
                         onerror="this.onerror=null; this.src='https://via.placeholder.com/640x360.png?text=Failed';">
                    
                    <div class="absolute inset-0 flex items-center justify-center 
                        bg-black bg-opacity-30 opacity-0 group-hover:opacity-100 
                        transition-opacity duration-300 pointer-events-none">
                        <i class="fas fa-play text-white text-4xl p-4 rounded-full bg-indigo-600/80 hover:bg-indigo-700 transition"></i>
                    </div>
                </div>
                <div class="p-3 text-center">
                    <h3 class="text-base font-semibold text-gray-900 mt-1 truncate">${videoData.title}</h3>
                    <div class="text-xs text-gray-500 mt-1">
                        <i class="far fa-clock mr-1"></i> ${Math.floor(Math.random() * 5) + 1} menit
                    </div>
                </div>
            `;
            return card;
        }

        function displayVideos(page, updateUrl = true) { // Tambah parameter updateUrl
            const totalPages = Math.ceil(allVideos.length / VIDEOS_PER_PAGE);
            
            if (page < 1) page = 1;
            if (page > totalPages) page = totalPages;
            
            currentPage = page;
            gallery.innerHTML = ''; 
            window.scrollTo({ top: 0, behavior: 'smooth' }); 

            const startIndex = (page - 1) * VIDEOS_PER_PAGE;
            const endIndex = startIndex + VIDEOS_PER_PAGE;
            const videosOnPage = allVideos.slice(startIndex, endIndex);

            videosOnPage.forEach((v, index) => {
                const card = createVideoCardWithProxyThumbnail(v, index);
                gallery.appendChild(card);
            });
            
            renderPagination(totalPages);
            
            // Update Info & Input
            infoPaginasi.textContent = `Menampilkan ${startIndex + 1}-${Math.min(endIndex, allVideos.length)} dari ${allVideos.length} video. (Halaman ${currentPage} dari ${totalPages})`;
            pageInput.value = currentPage; 
            pageInput.max = totalPages; 

            // LOGIKA MEMPERBARUI URL UNTUK REFRESH
            if (updateUrl) {
                const newUrl = `${window.location.pathname}?page=${currentPage}${window.location.hash}`;
                window.history.pushState({ path: newUrl }, '', newUrl);
            }
        }

        function renderPagination(totalPages) {
            paginationContainer.innerHTML = ''; 
            if (totalPages <= 1) return;

            const prevButton = createPaginationButton('<i class="fas fa-angle-left"></i>', currentPage - 1, currentPage === 1);
            paginationContainer.appendChild(prevButton);
            
            let startPage = Math.max(1, currentPage - 2);
            let endPage = Math.min(totalPages, currentPage + 2);

            if (endPage - startPage < 4) {
                startPage = Math.max(1, endPage - 4);
            }
            if (endPage - startPage < 4) {
                endPage = Math.min(totalPages, startPage + 4);
            }

            for (let i = startPage; i <= endPage; i++) {
                const pageButton = createPaginationButton(i, i, i === currentPage);
                paginationContainer.appendChild(pageButton);
            }

            const nextButton = createPaginationButton('<i class="fas fa-angle-right"></i>', currentPage + 1, currentPage === totalPages);
            paginationContainer.appendChild(nextButton);
        }

        function createPaginationButton(text, pageNumber, isActive = false) {
            const button = document.createElement('button');
            button.innerHTML = text; 
            
            const baseClasses = 'px-4 py-2 rounded-lg font-semibold transition duration-200 flex items-center justify-center';
            
            if (isActive) {
                button.className = `${baseClasses} bg-indigo-600 text-white shadow-md`;
            } else if (pageNumber < 1 || pageNumber > Math.ceil(allVideos.length / VIDEOS_PER_PAGE)) {
                button.className = `${baseClasses} bg-gray-200 text-gray-500 cursor-not-allowed`;
                button.disabled = true;
            } else {
                button.className = `${baseClasses} bg-white border border-gray-300 text-gray-700 hover:bg-gray-100`;
                button.onclick = () => displayVideos(pageNumber);
            }

            return button;
        }
        
        function getPageFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            const pageParam = urlParams.get('page');
            const pageNumber = parseInt(pageParam);
            
            return (pageNumber > 0 && !isNaN(pageNumber)) ? pageNumber : 1;
        }
        
        function goToPageFromInput() {
            let page = parseInt(pageInput.value);
            const totalPages = Math.ceil(allVideos.length / VIDEOS_PER_PAGE);

            if (isNaN(page) || page < 1) {
                page = 1;
            } else if (page > totalPages) {
                page = totalPages;
            }
            
            displayVideos(page);
        }

        goToPageButton.addEventListener('click', goToPageFromInput);
        
        pageInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                goToPageFromInput();
            }
        });


        // --- LOAD DATA AWAL ---
        fetch('videos.json')
            .then(res => res.json())
            .then(data => {
                allVideos = data.videos;
                if (allVideos && allVideos.length > 0) {
                    const initialPage = getPageFromUrl();
                    displayVideos(initialPage, false); 
                } else {
                    gallery.innerHTML = '<p class="text-center col-span-full mt-10 text-xl text-gray-500">Tidak ada video ditemukan.</p>';
                }
            })
            .catch(error => {
                console.error('Gagal memuat videos.json:', error);
                gallery.innerHTML = '<p class="text-red-500 text-center col-span-full mt-10">Gagal memuat data video. Pastikan file videos.json ada.</p>';
            });
            
        // --- LOGIKA MODAL DIMODIFIKASI UNTUK MEMANGGIL IKLAN ---
        gallery.addEventListener('click', (event) => {
            const card = event.target.closest('[data-url]');
            if (card) {
                const videoUrl = card.dataset.url;
                const videoTitle = card.dataset.title;
                
                // Set sumber video dan judul
                videoPlayer.src = videoUrl;
                modalTitle.textContent = videoTitle;
                
                // Tampilkan modal
                modal.classList.remove('hidden');
                modal.classList.add('flex');
                document.body.classList.add('overflow-hidden');
                
                // Panggil fungsi inisialisasi iklan saat modal dibuka
                initImaAds(); 
            }
        });

        function closeModal() {
            videoPlayer.pause();
            videoPlayer.src = ""; 

            // Hancurkan Ads Manager dan Loader saat modal ditutup
            if (adsManager) {
                adsManager.destroy();
                adsManager = null;
            }
            if (adsLoader) {
                adsLoader = null;
            }
            adContainer.style.display = 'none';
            adContainer.innerHTML = ''; 

            modal.classList.remove('flex');
            modal.classList.add('hidden');
            document.body.classList.remove('overflow-hidden');
        }

        closeModalButton.addEventListener('click', closeModal);
        modal.addEventListener('click', (event) => {
            if (event.target === modal) {
                closeModal();
            }
        });
        document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape' && modal.classList.contains('flex')) {
                closeModal();
            }
        });
    </script>
</body>
</html>